# الاعدادات

- [مقدمة](#introduction)
- [اعدادات بيئة العمل](#environment-configuration)
    - [انواع متغيرات بيئة العمل](#environment-variable-types)
    - [الوصول لمتغيرات بيئة العمل](#retrieving-environment-configuration)
    - [تحديد بيئة العمل النشطة](#determining-the-current-environment)
    - [اخفاء متغيرات بيئة العمل عند حدوث خطأ](#hiding-environment-variables-from-debug)
- [الوصول الاعدادات](#accessing-configuration-values)
- [حفظ الاعدادات ](#configuration-caching)
- [وضع الصيانة](#maintenance-mode)

<a name="introduction"></a>
## مقدمة

جميع الاعدادات الخاصة بتطبيق لارفل موجوده داخل المجلد `config
` وسيتم شرح جميع الملفات الخاصة بالاعدادات ، حاول القاء نظرة على الملفات لتتعرف على بعض النقاط .

<a name="environment-configuration"></a>
## اعدادات بيئة العمل

لارفل يقدم ميزة جميلة وهي امكانية التعامل مع عدة اعدادات  للتطبيق ويمكن التغير بينها ، على سبيل المثال قد تقرر ان تستخدم مشغل معين للcache  في وضع التطوير  وتستخدم مشغل اخر عند وضع التشغيل النهائي للتطبيق
، يقوم لارفل باستخدام [DotEnv](https://github.com/vlucas/phpdotenv) 
وهي عبارة عن مكتبة بلغة php تمت كتابتها بواسطة Vane Lucas، 

عند انشاء مشروع سيحتوي على ملف
`.env.example` يوجد هذا الملف في المجلد الرئيسي للمشروع ، قم بتغيره الى `.env` .

 اما حالة انك استخدمت composer لانشاء المشروع فان الملف سيصبح  `.env` بصورة تلقائية .


ملف `.env
` يحتوي على متغيرات التطبيق مثل (اسم قاعدة البيانات ، نوع وحدة التخزين المستخدمة ،..) ينبغي ان تضع قيم المتغيرات الخاصة بك ، حيث ان لكل مبرمج اعدادات ببيئة عمل خاصة به (مثلا عند استخدام قواعد البيانات كلمة المرور الخاصة بالسيرفر المحلي الخاص بك قد تختلف عن كلمة المرور الخاصة بالسيرفر المحلي لاي مبرمج اخر ) والذي قد يسبب مشكلة امنية عن مشاركة المشروع مع مبرمج اخر ، 

اذا كنت في  تيم علي  التبيق قم بتضمين ملف `.env.example` 
باحتواه على كل المتغيرات التي يحتاجها المشروع دون كتابة القيم الخاصة بك ، وعند مشاركة المشروع مع اي مبرمج اخر يقوم هو بوضع القيم الخاصة به لهذه المتغيرات

ايضا قد تحتاج لانشاء ملف `.env.testing` وهذا الملف سيتم استخدام بديلاً عن`.env` عند استخدام PHPUnit tests
 او يمكن تشغيل امر `artisan` ملحقا ب `--env=testing`.

> {تنبيه} اي متغير في بيئة العمل يمكن تغير قيمته بواسطة متغير خارجي في مستوى السيرفر او مستوى نظام التشغيل 


<a name="environment-variable-types"></a>
### انواع متغيرات بيئة العمل


جميع المتغيرات التي توضح داخل `.env` يتم تمريرها كقيم نصية `strings
 `، لارفل توفر الدلة المساعدة `env()` والتي تقوم بارجاع البيانات المعرفة داخل ملف  `.env`  حسب الجدول التالي


`.env` القيمة في ملف  | `env()` القيمة التي ترجعها الداله
------------- | -------------
true | (bool) true
(true) | (bool) true
false | (bool) false
(false) | (bool) false
empty | (string) ''
(empty) | (string) ''
null | (null) null
(null) | (null) null


اذا اردت اسناد قيمة  تحتوي على فراغات داخل ال`.env` استخدم ال `""` حول قيمة المتغير

    APP_NAME="My Application"

<a name="retrieving-environment-configuration"></a>
### كيفية الوصول متغيرات بيئة العمل 


كل متغيرات بيئة العمل سيتم تمريرها للمصفوفة`$_ENV` عند  تشغيل التطبيق ،يمكن  استخدام الدالة المساعدة `env
()` لاسترجاع قيم المتغيرات داخل في اي مكان داخل التطبيق ، اذا كنت قد ألقيت نظرة على ملفات الاعدادات داخل المجلد `config
` فسترى انه تم استخدام الدالة `env()` عدة مرات مثلا داخل ملف 
 `app.php`


    'debug' => env('APP_DEBUG', false),


القيمة الثاينة التي تم تمريرها للدالة والتي هي `false
` هي القيمة الافتراضية والتي سترجعها الدالة في حالة لم تجد المتغير `APP_DEBUG` ضمن متغيرات بيئة العمل





<a name="determining-the-current-environment"></a>
### تحديد بيئة العمل النشطة


يمكنك معرفة بيئة العمل النشطة (التي تعمل عليها الان) من خلال المتغير  `APP_ENV` الموجود داخل `.env
` ويمكنك الوصول الي قيمة المتغير عبر الدالة `enviroment` 
الموجودة داخل الكلاس `App` 
[facade](/docs/{{version}}/facades)

    $environment = App::environment();


كما يمكنك ايضا تمرير اسم بيئة العمل للدالة `enviroment
` للتحقق من ان الاسم الذي تم تمريره هو اسم بيئة العمل النشطة حاليا 
حيث سترجع الدالة `evniroment`
احدى القيمتين `true/false` 
 
 وايضا يمكن تمرير مصفوفة من الاسماء وسترجع الدالة `true` في حالة كان احد القيم التي تم تمريرها هو بيئة العمل النشطة

    if (App::environment('local')) {
        // The environment is local
    }

    if (App::environment(['local', 'staging'])) {
        // The environment is either local OR staging...
    }

> {tip} عملية تحديد بيئة العمل النشطة قد تقوم بارجاع قيمة غير القيمة الموجودة في ملف `.env
>` ويرجع ذلك السبب الى ان قيمة المتغير 
`APP_ENV
>` قد تم تغيريها بواسطة تعريف المتغير خارج الملف او في اعدادات السيرفر، وهي خاصية مفيدة خصوصا في حالة كنت تريد مشاركة نفس التطبيق لاعدادات مختلفة

<a name="hiding-environment-variables-from-debug"></a>
### اخفاء متغيرات بيئة العمل عند حدوث خطأ

عند حدوث `Execption` في التطبيق واذا كانت قيمة المتغير `APP_DEBUG` في ملف `.env` تساوي `true` ما يعني انه سيتم عرض محتويات ملف بيئة العمل ، قد تريد ان تقوم باخفاء بعض او كل المتغيرات حتى لا يتم عرضها في صفحة الخطأ كل ما عليك فعله هو اضافة المتغيرات مصفوفة `depug_backlist` في ملف `config/app.php` 

بعض المتغيرات موجودة في كمتغيرات للسيرفر ومتغيرات لبيئة العمل ستحتاج لوضعها في القائمتين معا 

    return [

        // ...

        'debug_blacklist' => [
            '_ENV' => [
                'APP_KEY',
                'DB_PASSWORD',
            ],

            '_SERVER' => [
                'APP_KEY',
                'DB_PASSWORD',
            ],

            '_POST' => [
                'password',
            ],
        ],
    ];

<a name="accessing-configuration-values"></a>
## كيفية الوصول لمتغيرات الاعدادات 


(المقصود بالاعدادات هنا كل الملفات الموجودة داخل المجلد `config` )

لارفل يوفر دالة مساعدة تسمى `config` تستخدم للوصول لكافة قيم داخل ملفات الاعدادات الموجودة داخل المجلد `config
` هذه الدالة يمكن كتابتها في اي ملف داخل تطبيق اللارفل ، حيث تمرر لها قيمة نصية تمثل اسم الملف ثم اسم المتغير داخل الملف مثلا 


    $value = config('app.timezone');

هذا يعني ارجاع قيمة المتغير `timezone`  الموجود داخل الملف `app.php` داخل مجلد `config`

كما يمكن استخدام الدالة `config` لتغير قيمة اي من الاعدادات اثناء تنفيذ التطبيق عبر تمرير مصفوفة كالاتي 

    config(['app.timezone' => 'America/Chicago']);



<a name="configuration-caching"></a>
## حفظ الاعدادات 

لجعل تطبيق لارفل يعمل بصورة افضل ، يجب ان تقوم بعمل بحفظ نسخة من الاعدادات متسخدما ال cache  وذلك  من خلال الامر `config:cache
` وهو احد اوامر `artisan
` ، هذا الامر سيقوم بدمج كافة الاعدادات في ملف واحد مما سيعني تحميله بصورة اسرع عن طلب الاعدادات 

يمكنك تنفيذ الامر التالي لعمل التخزين `php artisan config:cache`
وننصح ان يتم تشغيل هذا الامر في وضع  التشغيل بعد الانتهاء من تطوير للتطبيق حيث ان اي استخدام له اثناء تطوير التطبيق يعني ان الاعدادات سيتم تخزنها وبالتالي لن تتغير عند اجراء اي تعديل على ملفات الاعدادات



>{tip} اذا قمت بتشغيل الامر `config:cache
` اثناء اعداد عملية التشغيل النهائية للمشروع يجب ان تتاكد من انك لا تستخدم الدالة `env
` الا داخل ملفات الاعدادات ، لانه وبمجرد ان يتم حفظ الاعدادات فلن يتم استدعاء الدالة `env` مرة اخرى وسترجع `null`



<a name="maintenance-mode"></a>
## وضع الصيانة

اثناء عمل التطبيق قد تحتاج الى اغلاق التطبيق من الزوار للقيام ببعض عمليات الصيانة، حيث سيعرض التطبيق واجهة للمستخدمين تحتوي على رسالة توضح ان الطبيق في وضع الصيانة ، هذا الامر سيجل من السهولة القيام بعملية تحديث التطبيق والقيام بتعديلات  ، واذا كان التطبيق في وضع الصيانة سيقوم بتشغيل كلاس`MaintenanceModeException ` والذي سيقوم بارجاع الرقم 503 كرقم لحالة الطلب 



    php artisan down


كما يمكن تغير الرسالة التي تظهر عبر اضافة المتغير `message` للامر السابق لتغير محتوى الرسالة التي تريدها ان تظهر للمستخدمين وكذلك الامر `retry
` لتضع قيمة `Retry-After` في `http headers` 


    php artisan down --message="جاري تحديث قواعد البيانات" --retry=60

عند وضع التطبيق في وضع الصيانة فان جميع المستخدمين والزوار بما في ذلك جهازك الذي تستخدمه لن يكونوا قادرين على الولوج الى التطبيق ، وقد تحتاج الى اجراء استثناء لجهازك الحالي يتم ذلك عبر السماح لip الجهاز المراد فتح التطبيق له باستخدام  الخاصية `allow` لاضافة `ip`


    php artisan down --allow=127.0.0.1 --allow=192.168.0.0/16


عند الانتهاء من عملية الصيانة لاعادة التطبيق الى العمل قم بتشغيل الامر التالي

    php artisan up


> {tip} اذا اردت تغير الواجهة التي تظهر قم بانشاء ملف 
> `resources/views
>/errors/503.blade.php`.
>  وضع الشكل الذي تريده

#### تاثير وضع الصيانة على العمليات الخلفية للتطبيق



اذا كان التطبيق في وضع الصيانة فان [queued jobs](/docs/{{version}}/queues
) لن يتم تكون قادرة على العمل وسيتم اعادة تشغيلها عن الغاء  وضع الصيانة 

#### بدائل لوضع الصيانة


بما ان وضع الصيانة يحتاج لعدة ثواني حتى يتم تفعيله ، يمكنك استخدام خيارات بديلة مثل [Envoyer](https://envoyer.io)  لتفعيل والغاء وضع الصيانة بدون اي تاخير .
